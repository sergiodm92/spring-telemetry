<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telescope</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js"></script>
    <noscript><style>body::before{content:"Telescope requires JavaScript enabled.";color:#e2e8f0;padding:2rem;}</style></noscript>
    <style>
        [x-cloak] { display: none !important; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0f1117;
            color: #e2e8f0;
        }

        .sidebar {
            background: #151822;
            border-right: 1px solid #1e2433;
        }

        .sidebar-item {
            transition: all 0.15s ease;
        }

        .sidebar-item:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .sidebar-item.active {
            background: rgba(139, 92, 246, 0.15);
            border-right: 2px solid #8b5cf6;
        }

        .card {
            background: #1a1f2e;
            border: 1px solid #1e2433;
            border-radius: 8px;
        }

        .entry-row {
            border-bottom: 1px solid #1e2433;
            transition: background 0.1s ease;
        }

        .entry-row:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        .badge {
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-get { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
        .badge-post { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .badge-put { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .badge-patch { background: rgba(168, 85, 247, 0.15); color: #a855f7; }
        .badge-delete { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

        .status-2xx { color: #22c55e; }
        .status-3xx { color: #3b82f6; }
        .status-4xx { color: #f59e0b; }
        .status-5xx { color: #ef4444; }

        .badge-hit { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
        .badge-miss { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .badge-put { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .badge-evict { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .badge-created { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
        .badge-updated { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .badge-deleted { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

        .tag-chip {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 9999px;
            background: rgba(139, 92, 246, 0.1);
            color: #a78bfa;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .log-info { border-left: 3px solid #3b82f6; }
        .log-warn { border-left: 3px solid #f59e0b; }
        .log-error { border-left: 3px solid #ef4444; }

        .detail-panel {
            transition: transform 0.2s ease;
        }

        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #2d3548; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #3d4558; }

        pre {
            background: #0d1017;
            border-radius: 6px;
            padding: 12px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.6;
        }

        .pulse-dot {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .stat-card {
            background: linear-gradient(135deg, #1a1f2e 0%, #151822 100%);
            border: 1px solid #1e2433;
            border-radius: 10px;
            transition: transform 0.15s ease, border-color 0.15s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: #8b5cf6;
        }

        .filter-dropdown {
            position: relative;
            min-width: 160px;
            max-width: 220px;
        }

        .filter-dropdown-trigger {
            background: #1a1f2e;
            border: 1px solid #1e2433;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            color: #e2e8f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            width: 100%;
            min-height: 28px;
        }

        .filter-dropdown-trigger:hover {
            border-color: rgba(139, 92, 246, 0.3);
        }

        .filter-dropdown-trigger.active {
            border-color: rgba(139, 92, 246, 0.5);
        }

        .filter-dropdown-panel {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 4px;
            background: #1a1f2e;
            border: 1px solid #2d3548;
            border-radius: 6px;
            z-index: 50;
            overflow: hidden;
            min-width: 220px;
        }

        .filter-dropdown-search {
            width: 100%;
            background: #151822;
            border: none;
            border-bottom: 1px solid #1e2433;
            padding: 6px 8px;
            font-size: 12px;
            color: #e2e8f0;
            outline: none;
        }

        .filter-dropdown-search::placeholder {
            color: #4b5563;
        }

        .filter-dropdown-list {
            max-height: 180px;
            overflow-y: auto;
        }

        .filter-dropdown-list::-webkit-scrollbar { width: 4px; }
        .filter-dropdown-list::-webkit-scrollbar-track { background: transparent; }
        .filter-dropdown-list::-webkit-scrollbar-thumb { background: #2d3548; border-radius: 2px; }

        .filter-dropdown-item {
            padding: 5px 8px;
            font-size: 12px;
            color: #d1d5db;
            cursor: pointer;
            transition: background 0.1s;
        }

        .filter-dropdown-item:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .filter-dropdown-item .item-sub {
            font-size: 10px;
            color: #6b7280;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
            font-size: 11px;
            padding: 1px 6px;
            border-radius: 4px;
            max-width: 150px;
        }

        .filter-chip span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .filter-chip button {
            color: #9ca3af;
            font-size: 14px;
            line-height: 1;
            cursor: pointer;
            flex-shrink: 0;
        }

        .filter-chip button:hover {
            color: #e2e8f0;
        }
    </style>
</head>
<body class="h-screen overflow-hidden" x-data="telescope()" x-init="init()">

    <div class="flex h-full">
        <!-- Sidebar -->
        <aside class="sidebar w-56 flex flex-col flex-shrink-0">
            <!-- Logo -->
            <div class="px-5 py-4 flex items-center gap-3 border-b border-[#1e2433]">
                <svg class="w-7 h-7 text-violet-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M2 12c0 5.523 4.477 10 10 10s10-4.477 10-10S17.523 2 12 2"/>
                    <path d="M12 2a15 15 0 0 1 4 10 15 15 0 0 1-4 10"/>
                    <path d="M2 12h20"/>
                </svg>
                <div>
                    <h1 class="text-base font-bold text-white">Telescope</h1>
                    <p class="text-[10px] text-gray-500 uppercase tracking-wider">Spring Boot</p>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 py-3 overflow-y-auto scrollbar-thin">
                <template x-for="item in navItems" :key="item.id">
                    <button
                        @click="navigate(item.id)"
                        :class="{'active': currentView === item.id}"
                        class="sidebar-item w-full flex items-center gap-3 px-5 py-2.5 text-sm text-gray-400 hover:text-white cursor-pointer">
                        <span x-html="item.icon" class="w-4 h-4 flex-shrink-0"></span>
                        <span x-text="item.label"></span>
                        <span x-show="stats[item.type]"
                              x-text="stats[item.type]"
                              class="ml-auto text-xs bg-[#1e2433] text-gray-500 px-1.5 py-0.5 rounded"></span>
                    </button>
                </template>
            </nav>

            <!-- Status -->
            <div class="px-5 py-3 border-t border-[#1e2433] text-xs text-gray-600">
                <div class="flex items-center gap-2">
                    <div :class="enabled ? 'bg-green-500' : 'bg-red-500'" class="w-2 h-2 rounded-full pulse-dot"></div>
                    <span x-text="enabled ? 'Recording' : 'Paused'"></span>
                </div>
            </div>
        </aside>

        <!-- Main -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Top bar -->
            <header class="flex items-center gap-4 px-6 py-3 border-b border-[#1e2433] bg-[#131620]">
                <h2 class="text-sm font-semibold text-white" x-text="currentTitle"></h2>

                <div class="flex-1"></div>

                <!-- Filters -->
                <div x-show="currentView !== 'home'" class="flex items-center gap-2">
                    <!-- User filter -->
                    <div class="filter-dropdown" @click.outside="ddUser = false">
                        <div class="filter-dropdown-trigger" :class="{ active: ddUser }" @click="ddUser = !ddUser; ddTenant = false; ddMethod = false; ddStatus = false; ddUserSearch = ''; $nextTick(() => ddUser && $refs.userSearch.focus())">
                            <template x-if="!filterUserIdentifier">
                                <span class="text-gray-500">All Users</span>
                            </template>
                            <template x-if="filterUserIdentifier">
                                <div class="filter-chip">
                                    <span x-text="getUserDisplayName(filterUserIdentifier)"></span>
                                    <button @click.stop="filterUserIdentifier = ''; onFilterChange()">&times;</button>
                                </div>
                            </template>
                            <svg class="w-3 h-3 ml-auto text-gray-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div x-show="ddUser" x-cloak x-transition class="filter-dropdown-panel">
                            <input x-ref="userSearch" x-model="ddUserSearch" class="filter-dropdown-search" placeholder="Search users..." @keydown.escape="ddUser = false">
                            <div class="filter-dropdown-list">
                                <template x-for="user in filteredUsers()" :key="user.id">
                                    <div class="filter-dropdown-item" @click="filterUserIdentifier = user.id; ddUser = false; ddUserSearch = ''; onFilterChange()">
                                        <div x-text="user.name"></div>
                                        <div class="item-sub" x-text="user.id"></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Tenant filter -->
                    <div class="filter-dropdown" @click.outside="ddTenant = false">
                        <div class="filter-dropdown-trigger" :class="{ active: ddTenant }" @click="ddTenant = !ddTenant; ddUser = false; ddMethod = false; ddStatus = false; ddTenantSearch = ''; $nextTick(() => ddTenant && $refs.tenantSearch.focus())">
                            <template x-if="!filterTenantId">
                                <span class="text-gray-500">All Tenants</span>
                            </template>
                            <template x-if="filterTenantId">
                                <div class="filter-chip">
                                    <span x-text="getTenantDisplayName(filterTenantId)"></span>
                                    <button @click.stop="filterTenantId = ''; onFilterChange()">&times;</button>
                                </div>
                            </template>
                            <svg class="w-3 h-3 ml-auto text-gray-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div x-show="ddTenant" x-cloak x-transition class="filter-dropdown-panel">
                            <input x-ref="tenantSearch" x-model="ddTenantSearch" class="filter-dropdown-search" placeholder="Search tenants..." @keydown.escape="ddTenant = false">
                            <div class="filter-dropdown-list">
                                <template x-for="tenant in filteredTenants()" :key="tenant.id">
                                    <div class="filter-dropdown-item" @click="filterTenantId = tenant.id; ddTenant = false; ddTenantSearch = ''; onFilterChange()">
                                        <div x-text="tenant.name"></div>
                                        <div class="item-sub" x-text="'ID: ' + tenant.id"></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Method filter (requests only) -->
                    <div x-show="currentView === 'requests'" class="filter-dropdown" style="min-width:110px" @click.outside="ddMethod = false">
                        <div class="filter-dropdown-trigger" :class="{ active: ddMethod }" @click="ddMethod = !ddMethod; ddUser = false; ddTenant = false; ddStatus = false">
                            <template x-if="!filterMethod">
                                <span class="text-gray-500">Method</span>
                            </template>
                            <template x-if="filterMethod">
                                <div class="filter-chip">
                                    <span x-text="filterMethod"></span>
                                    <button @click.stop="filterMethod = ''; onFilterChange()">&times;</button>
                                </div>
                            </template>
                            <svg class="w-3 h-3 ml-auto text-gray-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div x-show="ddMethod" x-cloak x-transition class="filter-dropdown-panel" style="min-width:130px">
                            <div class="filter-dropdown-list">
                                <template x-for="m in filterOptions.methods" :key="m">
                                    <div class="filter-dropdown-item" @click="filterMethod = m; ddMethod = false; onFilterChange()">
                                        <span class="badge" :class="'badge-' + m.toLowerCase()" x-text="m"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Status filter (requests only) -->
                    <div x-show="currentView === 'requests'" class="filter-dropdown" style="min-width:100px" @click.outside="ddStatus = false">
                        <div class="filter-dropdown-trigger" :class="{ active: ddStatus }" @click="ddStatus = !ddStatus; ddUser = false; ddTenant = false; ddMethod = false">
                            <template x-if="!filterStatusGroup">
                                <span class="text-gray-500">Status</span>
                            </template>
                            <template x-if="filterStatusGroup">
                                <div class="filter-chip">
                                    <span x-text="filterStatusGroup"></span>
                                    <button @click.stop="filterStatusGroup = ''; onFilterChange()">&times;</button>
                                </div>
                            </template>
                            <svg class="w-3 h-3 ml-auto text-gray-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
                        </div>
                        <div x-show="ddStatus" x-cloak x-transition class="filter-dropdown-panel" style="min-width:110px">
                            <div class="filter-dropdown-list">
                                <template x-for="s in filterOptions.statuses" :key="s">
                                    <div class="filter-dropdown-item" @click="filterStatusGroup = s; ddStatus = false; onFilterChange()">
                                        <span :class="'status-' + s" x-text="s"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search -->
                <div x-show="currentView !== 'home'" class="relative">
                    <input type="text"
                           x-model="searchQuery"
                           @input.debounce.300ms="fetchEntries()"
                           placeholder="Search..."
                           class="bg-[#1a1f2e] border border-[#1e2433] rounded-md px-3 py-1.5 text-sm text-gray-300 w-64 focus:outline-none focus:border-violet-500/50 placeholder-gray-600">
                    <svg class="absolute right-3 top-2 w-4 h-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>

                <!-- Auto-refresh toggle -->
                <button @click="toggleAutoRefresh()"
                        :class="autoRefresh ? 'text-violet-400 bg-violet-500/10' : 'text-gray-500 bg-[#1a1f2e]'"
                        class="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-colors">
                    <svg class="w-3.5 h-3.5" :class="{'animate-spin': autoRefresh}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    <span x-text="autoRefresh ? 'Auto' : 'Manual'"></span>
                </button>

                <!-- Enable/Disable -->
                <button @click="toggleEnabled()"
                        :class="enabled ? 'text-green-400 bg-green-500/10' : 'text-red-400 bg-red-500/10'"
                        class="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-colors">
                    <div :class="enabled ? 'bg-green-400' : 'bg-red-400'" class="w-2 h-2 rounded-full"></div>
                    <span x-text="enabled ? 'Enabled' : 'Disabled'"></span>
                </button>

                <!-- Clear -->
                <button x-show="currentView !== 'home'"
                        @click="clearEntries()"
                        class="text-gray-500 hover:text-red-400 p-1.5 rounded transition-colors"
                        title="Clear entries">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            </header>

            <!-- Content -->
            <div class="flex-1 overflow-hidden flex">
                <!-- List view -->
                <div class="flex-1 overflow-y-auto scrollbar-thin p-6" :class="{'pr-0': selectedEntry}">

                    <!-- Home / Stats Dashboard -->
                    <template x-if="currentView === 'home'">
                        <div>
                            <div class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 mb-8">
                                <template x-for="item in navItems.filter(n => n.type)" :key="item.id">
                                    <div @click="navigate(item.id)" class="stat-card p-5 cursor-pointer">
                                        <div class="flex items-center gap-3 mb-3">
                                            <div class="p-2 rounded-lg" :class="item.bgClass">
                                                <span x-html="item.icon" class="w-4 h-4" :class="item.colorClass"></span>
                                            </div>
                                        </div>
                                        <p class="text-2xl font-bold text-white" x-text="stats[item.type] || 0"></p>
                                        <p class="text-xs text-gray-500 mt-1" x-text="item.label"></p>
                                    </div>
                                </template>
                            </div>

                            <!-- Prune -->
                            <div class="flex items-center gap-3 mb-4">
                                <button @click="pruneEntries()"
                                        class="flex items-center gap-2 px-4 py-2 rounded-md text-xs font-medium bg-[#1a1f2e] border border-[#1e2433] text-gray-400 hover:text-orange-400 hover:border-orange-500/30 transition-colors">
                                    <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                    Prune entries older than 24h
                                </button>
                                <span x-show="pruneResult" x-text="pruneResult" class="text-xs text-green-400" x-transition></span>
                            </div>

                            <!-- Recent requests preview -->
                            <div class="card p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-sm font-semibold text-gray-300">Recent Requests</h3>
                                    <button @click="navigate('requests')" class="text-xs text-violet-400 hover:text-violet-300">View all</button>
                                </div>
                                <div class="space-y-1">
                                    <template x-for="entry in recentRequests" :key="entry.uuid">
                                        <div @click="navigate('requests'); $nextTick(() => selectEntry(entry))"
                                             class="entry-row flex items-center gap-3 px-3 py-2 rounded cursor-pointer text-sm">
                                            <span class="badge" :class="'badge-' + (entry.content?.method || '').toLowerCase()"
                                                  x-text="entry.content?.method"></span>
                                            <span class="text-gray-300 truncate flex-1 font-mono text-xs" x-text="entry.content?.uri"></span>
                                            <span class="text-xs font-mono"
                                                  :class="getStatusClass(entry.content?.status)"
                                                  x-text="entry.content?.status"></span>
                                            <span class="text-xs text-gray-600" x-text="entry.content?.duration + 'ms'"></span>
                                            <span class="text-xs text-gray-600" x-text="formatTime(entry.createdAt)"></span>
                                        </div>
                                    </template>
                                    <p x-show="recentRequests.length === 0" class="text-sm text-gray-600 text-center py-4">No requests recorded yet</p>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Requests View -->
                    <template x-if="currentView === 'requests'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5 border-l-2 border-l-violet-500': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row flex items-center gap-3 px-4 py-3 cursor-pointer">
                                        <span class="badge" :class="'badge-' + (entry.content?.method || '').toLowerCase()"
                                              x-text="entry.content?.method"></span>
                                        <span class="text-gray-300 truncate flex-1 font-mono text-xs" x-text="entry.content?.uri"></span>
                                        <span class="text-xs font-mono"
                                              :class="getStatusClass(entry.content?.status)"
                                              x-text="entry.content?.status"></span>
                                        <span class="text-xs text-gray-600 font-mono" x-text="entry.content?.duration + 'ms'"></span>
                                        <span class="text-xs text-gray-600 w-16 text-right" x-text="formatTime(entry.createdAt)"></span>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No requests recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Exceptions View -->
                    <template x-if="currentView === 'exceptions'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5 border-l-2 border-l-violet-500': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row px-4 py-3 cursor-pointer">
                                        <div class="flex items-center gap-3">
                                            <span class="text-red-400 text-xs font-mono" x-text="entry.content?.class?.split('.')?.pop()"></span>
                                            <span class="text-gray-300 text-sm truncate flex-1" x-text="entry.content?.message"></span>
                                            <span class="text-xs text-gray-600" x-text="formatTime(entry.createdAt)"></span>
                                        </div>
                                        <div class="flex items-center gap-2 mt-1">
                                            <span class="text-xs text-gray-600 font-mono" x-text="entry.content?.location"></span>
                                            <template x-if="entry.content?.uri">
                                                <span class="text-xs text-gray-600">
                                                    &mdash; <span x-text="entry.content?.method"></span> <span x-text="entry.content?.uri"></span>
                                                </span>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No exceptions recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Queries View -->
                    <template x-if="currentView === 'queries'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5 border-l-2 border-l-violet-500': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row px-4 py-3 cursor-pointer">
                                        <div class="flex items-center gap-3">
                                            <span class="badge text-xs"
                                                  :class="{
                                                      'bg-green-500/15 text-green-400': entry.content?.type === 'SELECT',
                                                      'bg-blue-500/15 text-blue-400': entry.content?.type === 'INSERT',
                                                      'bg-yellow-500/15 text-yellow-400': entry.content?.type === 'UPDATE',
                                                      'bg-red-500/15 text-red-400': entry.content?.type === 'DELETE',
                                                      'bg-gray-500/15 text-gray-400': !['SELECT','INSERT','UPDATE','DELETE'].includes(entry.content?.type)
                                                  }"
                                                  x-text="entry.content?.type"></span>
                                            <span class="text-gray-300 truncate flex-1 font-mono text-xs" x-text="truncateSql(entry.content?.sql)"></span>
                                            <span class="text-xs text-gray-600" x-text="formatTime(entry.createdAt)"></span>
                                        </div>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No queries recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Logs View -->
                    <template x-if="currentView === 'logs'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row px-4 py-3 cursor-pointer"
                                         :class="'log-' + (entry.content?.level || '').toLowerCase()">
                                        <div class="flex items-center gap-3">
                                            <span class="text-xs font-bold w-12"
                                                  :class="{
                                                      'text-blue-400': entry.content?.level === 'INFO',
                                                      'text-yellow-400': entry.content?.level === 'WARN',
                                                      'text-red-400': entry.content?.level === 'ERROR'
                                                  }"
                                                  x-text="entry.content?.level"></span>
                                            <span class="text-gray-300 text-sm truncate flex-1" x-text="entry.content?.message"></span>
                                            <span class="text-xs text-gray-600 font-mono" x-text="entry.content?.logger?.split('.')?.pop()"></span>
                                            <span class="text-xs text-gray-600" x-text="formatTime(entry.createdAt)"></span>
                                        </div>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No logs recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Schedule View -->
                    <template x-if="currentView === 'schedule'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5 border-l-2 border-l-violet-500': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row flex items-center gap-3 px-4 py-3 cursor-pointer">
                                        <span class="badge text-xs"
                                              :class="entry.content?.status === 'completed' ? 'bg-green-500/15 text-green-400' : 'bg-red-500/15 text-red-400'"
                                              x-text="entry.content?.status"></span>
                                        <span class="text-gray-300 text-sm font-mono" x-text="entry.content?.class + '.' + entry.content?.method"></span>
                                        <span class="flex-1"></span>
                                        <span class="text-xs text-gray-600 font-mono" x-text="entry.content?.duration + 'ms'"></span>
                                        <span class="text-xs text-gray-600" x-text="formatTime(entry.createdAt)"></span>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No scheduled tasks recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Cache View -->
                    <template x-if="currentView === 'cache'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5 border-l-2 border-l-violet-500': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row flex items-center gap-3 px-4 py-3 cursor-pointer">
                                        <span class="badge text-xs"
                                              :class="'badge-' + (entry.content?.operation || '').toLowerCase()"
                                              x-text="entry.content?.operation"></span>
                                        <span class="text-gray-300 text-sm font-mono" x-text="entry.content?.cacheName"></span>
                                        <span class="text-gray-500 text-xs truncate flex-1 font-mono" x-text="entry.content?.key"></span>
                                        <span class="text-xs text-gray-600 font-mono" x-text="entry.content?.duration + 'ms'"></span>
                                        <span class="text-xs text-gray-600 w-16 text-right" x-text="formatTime(entry.createdAt)"></span>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No cache operations recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Events View -->
                    <template x-if="currentView === 'events'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5 border-l-2 border-l-violet-500': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row flex items-center gap-3 px-4 py-3 cursor-pointer">
                                        <span class="text-orange-400 text-sm font-mono font-semibold" x-text="entry.content?.event"></span>
                                        <span class="text-gray-500 text-xs flex-1" x-text="entry.content?.source"></span>
                                        <span class="text-xs text-gray-600 w-16 text-right" x-text="formatTime(entry.createdAt)"></span>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No events recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Mail View -->
                    <template x-if="currentView === 'mail'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5 border-l-2 border-l-violet-500': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row px-4 py-3 cursor-pointer">
                                        <div class="flex items-center gap-3">
                                            <span class="text-pink-400 text-sm truncate flex-1" x-text="entry.content?.subject || '(no subject)'"></span>
                                            <span class="text-xs text-gray-500 font-mono" x-text="entry.content?.to"></span>
                                            <span class="text-xs text-gray-600 w-16 text-right" x-text="formatTime(entry.createdAt)"></span>
                                        </div>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No mail recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Models View -->
                    <template x-if="currentView === 'models'">
                        <div>
                            <div class="card overflow-hidden">
                                <template x-for="entry in entries" :key="entry.uuid">
                                    <div @click="selectEntry(entry)"
                                         :class="{'bg-violet-500/5 border-l-2 border-l-violet-500': selectedEntry?.uuid === entry.uuid}"
                                         class="entry-row flex items-center gap-3 px-4 py-3 cursor-pointer">
                                        <span class="badge text-xs"
                                              :class="'badge-' + (entry.content?.action || '').toLowerCase()"
                                              x-text="entry.content?.action"></span>
                                        <span class="text-teal-400 text-sm font-mono" x-text="entry.content?.entity"></span>
                                        <span class="text-gray-500 text-xs font-mono" x-text="'#' + entry.content?.entityId"></span>
                                        <span class="text-gray-600 text-xs truncate flex-1" x-text="(entry.content?.changedFields || []).join(', ')"></span>
                                        <span class="text-xs text-gray-600 w-16 text-right" x-text="formatTime(entry.createdAt)"></span>
                                    </div>
                                </template>
                                <p x-show="entries.length === 0" class="text-sm text-gray-600 text-center py-8">No model changes recorded</p>
                            </div>
                        </div>
                    </template>

                    <!-- Pagination -->
                    <div x-show="currentView !== 'home' && totalEntries > pageSize" class="flex items-center justify-between mt-4 px-1">
                        <span class="text-xs text-gray-600">
                            Showing <span x-text="currentPage * pageSize + 1"></span>-<span x-text="Math.min((currentPage + 1) * pageSize, totalEntries)"></span>
                            of <span x-text="totalEntries"></span>
                        </span>
                        <div class="flex gap-2">
                            <button @click="prevPage()" :disabled="currentPage === 0"
                                    :class="currentPage === 0 ? 'opacity-30 cursor-default' : 'hover:bg-[#1e2433]'"
                                    class="px-3 py-1 rounded text-xs text-gray-400">Previous</button>
                            <button @click="nextPage()" :disabled="(currentPage + 1) * pageSize >= totalEntries"
                                    :class="(currentPage + 1) * pageSize >= totalEntries ? 'opacity-30 cursor-default' : 'hover:bg-[#1e2433]'"
                                    class="px-3 py-1 rounded text-xs text-gray-400">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Detail Panel -->
                <div x-show="selectedEntry" x-cloak
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="translate-x-full"
                     x-transition:enter-end="translate-x-0"
                     class="detail-panel w-[520px] border-l border-[#1e2433] bg-[#131620] overflow-y-auto scrollbar-thin flex-shrink-0">

                    <div class="sticky top-0 bg-[#131620] border-b border-[#1e2433] px-5 py-3 flex items-center justify-between z-10">
                        <h3 class="text-sm font-semibold text-white">Entry Detail</h3>
                        <button @click="selectedEntry = null" class="text-gray-500 hover:text-white p-1">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>

                    <template x-if="selectedEntry">
                        <div class="p-5 space-y-5">
                            <!-- Request Detail -->
                            <template x-if="selectedEntry.type === 'REQUEST'">
                                <div class="space-y-4">
                                    <div class="flex items-center gap-3">
                                        <span class="badge" :class="'badge-' + (selectedEntry.content?.method || '').toLowerCase()"
                                              x-text="selectedEntry.content?.method"></span>
                                        <span :class="getStatusClass(selectedEntry.content?.status)"
                                              class="text-sm font-bold" x-text="selectedEntry.content?.status"></span>
                                        <span class="text-xs text-gray-500" x-text="selectedEntry.content?.duration + 'ms'"></span>
                                    </div>
                                    <p class="font-mono text-xs text-gray-300 break-all" x-text="selectedEntry.content?.uri + (selectedEntry.content?.queryString ? '?' + selectedEntry.content.queryString : '')"></p>

                                    <div class="space-y-3">
                                        <div>
                                            <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">IP Address</h4>
                                            <p class="text-xs text-gray-400 font-mono" x-text="selectedEntry.content?.ipAddress"></p>
                                        </div>

                                        <div>
                                            <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Request Headers</h4>
                                            <div class="bg-[#0d1017] rounded-md p-3 space-y-1">
                                                <template x-for="(val, key) in selectedEntry.content?.requestHeaders || {}" :key="key">
                                                    <div class="flex gap-2 text-xs">
                                                        <span class="text-violet-400 font-mono" x-text="key + ':'"></span>
                                                        <span class="text-gray-400 font-mono break-all" x-text="val"></span>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>

                                        <div x-show="selectedEntry.content?.requestBody">
                                            <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Request Body</h4>
                                            <pre class="text-gray-300" x-text="formatJson(selectedEntry.content?.requestBody)"></pre>
                                        </div>

                                        <div>
                                            <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Response Headers</h4>
                                            <div class="bg-[#0d1017] rounded-md p-3 space-y-1">
                                                <template x-for="(val, key) in selectedEntry.content?.responseHeaders || {}" :key="key">
                                                    <div class="flex gap-2 text-xs">
                                                        <span class="text-violet-400 font-mono" x-text="key + ':'"></span>
                                                        <span class="text-gray-400 font-mono break-all" x-text="val"></span>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>

                                        <div x-show="selectedEntry.content?.responseBody">
                                            <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Response Body</h4>
                                            <pre class="text-gray-300 max-h-96 overflow-auto scrollbar-thin" x-text="formatJson(selectedEntry.content?.responseBody)"></pre>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Exception Detail -->
                            <template x-if="selectedEntry.type === 'EXCEPTION'">
                                <div class="space-y-4">
                                    <div>
                                        <p class="text-red-400 font-mono text-sm font-bold" x-text="selectedEntry.content?.class"></p>
                                        <p class="text-gray-300 text-sm mt-1" x-text="selectedEntry.content?.message"></p>
                                    </div>

                                    <div x-show="selectedEntry.content?.uri" class="flex items-center gap-2 text-xs text-gray-500">
                                        <span x-text="selectedEntry.content?.method"></span>
                                        <span class="font-mono" x-text="selectedEntry.content?.uri"></span>
                                    </div>

                                    <div x-show="selectedEntry.content?.location">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Location</h4>
                                        <p class="text-xs text-gray-400 font-mono" x-text="selectedEntry.content?.location + ' (line ' + selectedEntry.content?.line + ')'"></p>
                                    </div>

                                    <div x-show="selectedEntry.content?.cause">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Caused By</h4>
                                        <p class="text-xs text-orange-400 font-mono" x-text="selectedEntry.content?.cause"></p>
                                    </div>

                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Stack Trace</h4>
                                        <pre class="text-gray-400 text-[11px] max-h-[400px] overflow-auto scrollbar-thin" x-text="selectedEntry.content?.trace"></pre>
                                    </div>
                                </div>
                            </template>

                            <!-- Query Detail -->
                            <template x-if="selectedEntry.type === 'QUERY'">
                                <div class="space-y-4">
                                    <div class="flex items-center gap-2">
                                        <span class="badge text-xs"
                                              :class="{
                                                  'bg-green-500/15 text-green-400': selectedEntry.content?.type === 'SELECT',
                                                  'bg-blue-500/15 text-blue-400': selectedEntry.content?.type === 'INSERT',
                                                  'bg-yellow-500/15 text-yellow-400': selectedEntry.content?.type === 'UPDATE',
                                                  'bg-red-500/15 text-red-400': selectedEntry.content?.type === 'DELETE'
                                              }"
                                              x-text="selectedEntry.content?.type"></span>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">SQL</h4>
                                        <pre class="text-green-300 text-xs" x-text="formatSql(selectedEntry.content?.sql)"></pre>
                                    </div>
                                </div>
                            </template>

                            <!-- Log Detail -->
                            <template x-if="selectedEntry.type === 'LOG'">
                                <div class="space-y-4">
                                    <div class="flex items-center gap-3">
                                        <span class="text-sm font-bold"
                                              :class="{
                                                  'text-blue-400': selectedEntry.content?.level === 'INFO',
                                                  'text-yellow-400': selectedEntry.content?.level === 'WARN',
                                                  'text-red-400': selectedEntry.content?.level === 'ERROR'
                                              }"
                                              x-text="selectedEntry.content?.level"></span>
                                        <span class="text-xs text-gray-500 font-mono" x-text="selectedEntry.content?.logger"></span>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Message</h4>
                                        <pre class="text-gray-300" x-text="selectedEntry.content?.message"></pre>
                                    </div>
                                    <div x-show="selectedEntry.content?.exception">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Exception</h4>
                                        <pre class="text-red-300 text-[11px] max-h-80 overflow-auto scrollbar-thin" x-text="selectedEntry.content?.exception"></pre>
                                    </div>
                                    <div x-show="selectedEntry.content?.mdc">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">MDC Context</h4>
                                        <pre class="text-gray-400" x-text="JSON.stringify(selectedEntry.content?.mdc, null, 2)"></pre>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Thread</h4>
                                        <p class="text-xs text-gray-500 font-mono" x-text="selectedEntry.content?.thread"></p>
                                    </div>
                                </div>
                            </template>

                            <!-- Schedule Detail -->
                            <template x-if="selectedEntry.type === 'SCHEDULE'">
                                <div class="space-y-4">
                                    <div class="flex items-center gap-3">
                                        <span class="badge text-xs"
                                              :class="selectedEntry.content?.status === 'completed' ? 'bg-green-500/15 text-green-400' : 'bg-red-500/15 text-red-400'"
                                              x-text="selectedEntry.content?.status"></span>
                                        <span class="text-xs text-gray-500" x-text="selectedEntry.content?.duration + 'ms'"></span>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Task</h4>
                                        <p class="text-sm font-mono text-gray-300" x-text="selectedEntry.content?.class + '.' + selectedEntry.content?.method + '()'"></p>
                                    </div>
                                    <div x-show="selectedEntry.content?.exception">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Exception</h4>
                                        <pre class="text-red-300" x-text="selectedEntry.content?.exception"></pre>
                                    </div>
                                </div>
                            </template>

                            <!-- Cache Detail -->
                            <template x-if="selectedEntry.type === 'CACHE'">
                                <div class="space-y-4">
                                    <div class="flex items-center gap-3">
                                        <span class="badge text-xs"
                                              :class="'badge-' + (selectedEntry.content?.operation || '').toLowerCase()"
                                              x-text="selectedEntry.content?.operation"></span>
                                        <span class="text-xs text-gray-500" x-text="selectedEntry.content?.duration + 'ms'"></span>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Cache Name</h4>
                                        <p class="text-sm font-mono text-gray-300" x-text="selectedEntry.content?.cacheName"></p>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Key</h4>
                                        <pre class="text-gray-300 text-xs" x-text="selectedEntry.content?.key"></pre>
                                    </div>
                                </div>
                            </template>

                            <!-- Event Detail -->
                            <template x-if="selectedEntry.type === 'EVENT'">
                                <div class="space-y-4">
                                    <div>
                                        <p class="text-orange-400 font-mono text-sm font-bold" x-text="selectedEntry.content?.event"></p>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Event Class</h4>
                                        <p class="text-xs text-gray-400 font-mono" x-text="selectedEntry.content?.eventClass"></p>
                                    </div>
                                    <div x-show="selectedEntry.content?.source">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Source</h4>
                                        <p class="text-xs text-gray-400 font-mono" x-text="selectedEntry.content?.source"></p>
                                    </div>
                                    <div x-show="selectedEntry.content?.payload && Object.keys(selectedEntry.content.payload).length > 0">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Payload</h4>
                                        <pre class="text-gray-300 text-xs" x-text="JSON.stringify(selectedEntry.content?.payload, null, 2)"></pre>
                                    </div>
                                </div>
                            </template>

                            <!-- Mail Detail -->
                            <template x-if="selectedEntry.type === 'MAIL'">
                                <div class="space-y-4">
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Subject</h4>
                                        <p class="text-sm text-pink-400 font-semibold" x-text="selectedEntry.content?.subject || '(no subject)'"></p>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">To</h4>
                                        <p class="text-xs text-gray-300 font-mono" x-text="selectedEntry.content?.to"></p>
                                    </div>
                                    <div x-show="selectedEntry.content?.from">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">From</h4>
                                        <p class="text-xs text-gray-300 font-mono" x-text="selectedEntry.content?.from"></p>
                                    </div>
                                    <div x-show="selectedEntry.content?.bodyPreview">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Body Preview</h4>
                                        <pre class="text-gray-300 text-xs whitespace-pre-wrap" x-text="selectedEntry.content?.bodyPreview"></pre>
                                    </div>
                                </div>
                            </template>

                            <!-- Model Detail -->
                            <template x-if="selectedEntry.type === 'MODEL'">
                                <div class="space-y-4">
                                    <div class="flex items-center gap-3">
                                        <span class="badge text-xs"
                                              :class="'badge-' + (selectedEntry.content?.action || '').toLowerCase()"
                                              x-text="selectedEntry.content?.action"></span>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Entity</h4>
                                        <p class="text-sm font-mono text-teal-400" x-text="selectedEntry.content?.entityClass"></p>
                                    </div>
                                    <div>
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Entity ID</h4>
                                        <p class="text-sm font-mono text-gray-300" x-text="selectedEntry.content?.entityId"></p>
                                    </div>
                                    <div x-show="selectedEntry.content?.changedFields && selectedEntry.content.changedFields.length > 0">
                                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Changed Fields</h4>
                                        <div class="flex flex-wrap gap-1.5">
                                            <template x-for="field in selectedEntry.content?.changedFields || []" :key="field">
                                                <span class="tag-chip" x-text="field"></span>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Related Entries -->
                            <div x-show="relatedEntries.length > 1" class="mt-6 pt-4 border-t border-[#1e2433]">
                                <h4 class="text-xs font-semibold text-gray-500 uppercase mb-3">Related Entries (same request)</h4>
                                <div class="space-y-1">
                                    <template x-for="rel in relatedEntries.filter(r => r.uuid !== selectedEntry?.uuid)" :key="rel.uuid">
                                        <div @click="selectEntry(rel)"
                                             class="flex items-center gap-2 px-3 py-2 rounded bg-[#0d1017] hover:bg-[#161b27] cursor-pointer text-xs">
                                            <span class="badge text-[10px]"
                                                  :class="{
                                                      'bg-violet-500/15 text-violet-400': rel.type === 'REQUEST',
                                                      'bg-red-500/15 text-red-400': rel.type === 'EXCEPTION',
                                                      'bg-green-500/15 text-green-400': rel.type === 'QUERY',
                                                      'bg-blue-500/15 text-blue-400': rel.type === 'LOG',
                                                      'bg-yellow-500/15 text-yellow-400': rel.type === 'SCHEDULE',
                                                      'bg-cyan-500/15 text-cyan-400': rel.type === 'CACHE',
                                                      'bg-orange-500/15 text-orange-400': rel.type === 'EVENT',
                                                      'bg-pink-500/15 text-pink-400': rel.type === 'MAIL',
                                                      'bg-teal-500/15 text-teal-400': rel.type === 'MODEL'
                                                  }"
                                                  x-text="rel.type"></span>
                                            <span class="text-gray-400 truncate" x-text="getEntrySummary(rel)"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Meta -->
                            <div class="mt-4 pt-4 border-t border-[#1e2433] space-y-2">
                                <div x-show="selectedEntry.userIdentifier" class="flex justify-between text-xs">
                                    <span class="text-gray-600">User</span>
                                    <span class="text-violet-400 font-mono" x-text="selectedEntry.userIdentifier"></span>
                                </div>
                                <div x-show="selectedEntry.tenantId" class="flex justify-between text-xs">
                                    <span class="text-gray-600">Tenant</span>
                                    <span class="text-violet-400 font-mono" x-text="selectedEntry.tenantId"></span>
                                </div>
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-600">UUID</span>
                                    <span class="text-gray-500 font-mono" x-text="selectedEntry.uuid"></span>
                                </div>
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-600">Recorded</span>
                                    <span class="text-gray-500" x-text="formatDateTime(selectedEntry.createdAt)"></span>
                                </div>
                                <div x-show="selectedEntry.batchId" class="flex justify-between text-xs">
                                    <span class="text-gray-600">Batch</span>
                                    <span class="text-gray-500 font-mono text-[10px]" x-text="selectedEntry.batchId"></span>
                                </div>
                            </div>

                            <!-- Tags -->
                            <div x-show="selectedEntry.tags && selectedEntry.tags.length > 0" class="mt-3 pt-3 border-t border-[#1e2433]">
                                <h4 class="text-xs font-semibold text-gray-600 uppercase mb-2">Tags</h4>
                                <div class="flex flex-wrap gap-1.5">
                                    <template x-for="tag in selectedEntry.tags || []" :key="tag">
                                        <span class="tag-chip" x-text="tag"></span>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </main>
    </div>

    <script>
        function telescope() {
            return {
                // State
                currentView: 'home',
                entries: [],
                recentRequests: [],
                selectedEntry: null,
                relatedEntries: [],
                stats: {},
                enabled: true,
                autoRefresh: true,
                searchQuery: '',
                currentPage: 0,
                pageSize: 50,
                totalEntries: 0,
                refreshInterval: null,
                filterUserIdentifier: '',
                filterTenantId: '',
                filterMethod: '',
                filterStatusGroup: '',
                filterOptions: { users: [], tenants: [], methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'], statuses: ['2xx', '3xx', '4xx', '5xx'] },
                ddUser: false,
                ddTenant: false,
                ddMethod: false,
                ddStatus: false,
                ddUserSearch: '',
                ddTenantSearch: '',
                pruneResult: '',

                // Navigation
                navItems: [
                    { id: 'home', label: 'Dashboard', type: null, icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>', bgClass: '', colorClass: '' },
                    { id: 'requests', label: 'Requests', type: 'REQUEST', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>', bgClass: 'bg-violet-500/10', colorClass: 'text-violet-400' },
                    { id: 'exceptions', label: 'Exceptions', type: 'EXCEPTION', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>', bgClass: 'bg-red-500/10', colorClass: 'text-red-400' },
                    { id: 'queries', label: 'Queries', type: 'QUERY', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>', bgClass: 'bg-green-500/10', colorClass: 'text-green-400' },
                    { id: 'logs', label: 'Logs', type: 'LOG', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>', bgClass: 'bg-blue-500/10', colorClass: 'text-blue-400' },
                    { id: 'schedule', label: 'Schedule', type: 'SCHEDULE', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>', bgClass: 'bg-yellow-500/10', colorClass: 'text-yellow-400' },
                    { id: 'cache', label: 'Cache', type: 'CACHE', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>', bgClass: 'bg-cyan-500/10', colorClass: 'text-cyan-400' },
                    { id: 'events', label: 'Events', type: 'EVENT', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>', bgClass: 'bg-orange-500/10', colorClass: 'text-orange-400' },
                    { id: 'mail', label: 'Mail', type: 'MAIL', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 4L12 13 2 4"/></svg>', bgClass: 'bg-pink-500/10', colorClass: 'text-pink-400' },
                    { id: 'models', label: 'Models', type: 'MODEL', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>', bgClass: 'bg-teal-500/10', colorClass: 'text-teal-400' },
                ],

                get currentTitle() {
                    const item = this.navItems.find(n => n.id === this.currentView);
                    return item ? item.label : 'Dashboard';
                },

                get currentType() {
                    const item = this.navItems.find(n => n.id === this.currentView);
                    return item?.type || null;
                },

                // API base - relative to current path
                get apiBase() {
                    const path = window.location.pathname;
                    const base = path.substring(0, path.lastIndexOf('/telescope'));
                    return base + '/telescope/api';
                },

                // Init
                async init() {
                    await this.fetchStats();
                    await this.fetchRecentRequests();
                    await this.fetchFilters();
                    this.startAutoRefresh();
                },

                // Navigation
                navigate(view) {
                    this.currentView = view;
                    this.currentPage = 0;
                    this.selectedEntry = null;
                    this.searchQuery = '';
                    this.filterMethod = '';
                    this.filterStatusGroup = '';
                    this.ddUser = false;
                    this.ddTenant = false;
                    this.ddMethod = false;
                    this.ddStatus = false;
                    if (view === 'home') {
                        this.fetchStats();
                        this.fetchRecentRequests();
                    } else {
                        this.fetchEntries();
                    }
                },

                onFilterChange() {
                    this.currentPage = 0;
                    this.selectedEntry = null;
                    this.fetchEntries();
                },

                // Fetch
                async fetchStats() {
                    try {
                        const res = await fetch(this.apiBase + '/stats');
                        const json = await res.json();
                        this.stats = json.data || {};
                    } catch (e) { console.error('Failed to fetch stats:', e); }
                },

                async fetchRecentRequests() {
                    try {
                        const res = await fetch(this.apiBase + '/entries?type=REQUEST&page=0&size=10');
                        const json = await res.json();
                        this.recentRequests = json.data?.entries || [];
                    } catch (e) { console.error('Failed to fetch recent requests:', e); }
                },

                async fetchFilters() {
                    try {
                        const res = await fetch(this.apiBase + '/filters');
                        const json = await res.json();
                        this.filterOptions = {
                            users: json.data?.users || [],
                            tenants: json.data?.tenants || [],
                            methods: json.data?.methods || ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],
                            statuses: json.data?.statuses || ['2xx', '3xx', '4xx', '5xx']
                        };
                    } catch (e) { console.error('Failed to fetch filters:', e); }
                },

                async fetchEntries() {
                    const type = this.currentType;
                    if (!type) return;
                    try {
                        let url = `${this.apiBase}/entries?type=${type}&page=${this.currentPage}&size=${this.pageSize}`;
                        if (this.searchQuery) url += `&search=${encodeURIComponent(this.searchQuery)}`;
                        if (this.filterUserIdentifier) url += `&userIdentifier=${encodeURIComponent(this.filterUserIdentifier)}`;
                        if (this.filterTenantId) url += `&tenantId=${encodeURIComponent(this.filterTenantId)}`;
                        if (this.filterMethod) url += `&method=${encodeURIComponent(this.filterMethod)}`;
                        if (this.filterStatusGroup) url += `&statusGroup=${encodeURIComponent(this.filterStatusGroup)}`;
                        const res = await fetch(url);
                        const json = await res.json();
                        this.entries = json.data?.entries || [];
                        this.totalEntries = json.data?.total || 0;
                    } catch (e) { console.error('Failed to fetch entries:', e); }
                },

                async fetchRelated(uuid) {
                    try {
                        const res = await fetch(this.apiBase + '/entries/' + uuid + '/related');
                        const json = await res.json();
                        this.relatedEntries = json.data || [];
                    } catch (e) { this.relatedEntries = []; }
                },

                // Select entry
                async selectEntry(entry) {
                    this.selectedEntry = entry;
                    if (entry.batchId) {
                        await this.fetchRelated(entry.uuid);
                    } else {
                        this.relatedEntries = [];
                    }
                },

                // Pagination
                prevPage() {
                    if (this.currentPage > 0) {
                        this.currentPage--;
                        this.fetchEntries();
                    }
                },

                nextPage() {
                    if ((this.currentPage + 1) * this.pageSize < this.totalEntries) {
                        this.currentPage++;
                        this.fetchEntries();
                    }
                },

                // Auto-refresh
                toggleAutoRefresh() {
                    this.autoRefresh = !this.autoRefresh;
                    if (this.autoRefresh) this.startAutoRefresh();
                    else this.stopAutoRefresh();
                },

                startAutoRefresh() {
                    this.stopAutoRefresh();
                    this.refreshInterval = setInterval(() => {
                        this.fetchStats();
                        this.fetchFilters();
                        if (this.currentView === 'home') {
                            this.fetchRecentRequests();
                        } else {
                            this.fetchEntries();
                        }
                    }, 5000);
                },

                stopAutoRefresh() {
                    if (this.refreshInterval) {
                        clearInterval(this.refreshInterval);
                        this.refreshInterval = null;
                    }
                },

                // Toggle enabled
                async toggleEnabled() {
                    try {
                        const res = await fetch(this.apiBase + '/toggle', { method: 'POST' });
                        const json = await res.json();
                        this.enabled = json.data;
                    } catch (e) { console.error('Failed to toggle:', e); }
                },

                // Clear
                async clearEntries() {
                    const type = this.currentType;
                    if (!type) return;
                    try {
                        await fetch(this.apiBase + '/entries?type=' + type, { method: 'DELETE' });
                        this.entries = [];
                        this.totalEntries = 0;
                        this.selectedEntry = null;
                        this.fetchStats();
                    } catch (e) { console.error('Failed to clear:', e); }
                },

                // Prune
                async pruneEntries() {
                    try {
                        const res = await fetch(this.apiBase + '/prune?hours=24', { method: 'POST' });
                        const json = await res.json();
                        const pruned = json.data?.pruned || 0;
                        this.pruneResult = `Pruned ${pruned} entries`;
                        this.fetchStats();
                        if (this.currentView !== 'home') this.fetchEntries();
                        setTimeout(() => { this.pruneResult = ''; }, 3000);
                    } catch (e) { console.error('Failed to prune:', e); }
                },

                // Helpers
                getStatusClass(status) {
                    if (!status) return 'text-gray-500';
                    if (status >= 500) return 'status-5xx';
                    if (status >= 400) return 'status-4xx';
                    if (status >= 300) return 'status-3xx';
                    return 'status-2xx';
                },

                formatTime(dateTime) {
                    if (!dateTime) return '';
                    try {
                        const d = Array.isArray(dateTime)
                            ? new Date(dateTime[0], dateTime[1]-1, dateTime[2], dateTime[3]||0, dateTime[4]||0, dateTime[5]||0)
                            : new Date(dateTime);
                        return d.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    } catch { return ''; }
                },

                formatDateTime(dateTime) {
                    if (!dateTime) return '';
                    try {
                        const d = Array.isArray(dateTime)
                            ? new Date(dateTime[0], dateTime[1]-1, dateTime[2], dateTime[3]||0, dateTime[4]||0, dateTime[5]||0)
                            : new Date(dateTime);
                        return d.toLocaleString();
                    } catch { return ''; }
                },

                formatJson(str) {
                    if (!str) return '';
                    try {
                        return JSON.stringify(JSON.parse(str), null, 2);
                    } catch { return str; }
                },

                formatSql(sql) {
                    if (!sql) return '';
                    return sql
                        .replace(/\bSELECT\b/gi, '\nSELECT')
                        .replace(/\bFROM\b/gi, '\nFROM')
                        .replace(/\bWHERE\b/gi, '\nWHERE')
                        .replace(/\bAND\b/gi, '\n  AND')
                        .replace(/\bOR\b/gi, '\n  OR')
                        .replace(/\bJOIN\b/gi, '\nJOIN')
                        .replace(/\bLEFT JOIN\b/gi, '\nLEFT JOIN')
                        .replace(/\bINNER JOIN\b/gi, '\nINNER JOIN')
                        .replace(/\bORDER BY\b/gi, '\nORDER BY')
                        .replace(/\bGROUP BY\b/gi, '\nGROUP BY')
                        .replace(/\bHAVING\b/gi, '\nHAVING')
                        .replace(/\bLIMIT\b/gi, '\nLIMIT')
                        .replace(/\bINSERT INTO\b/gi, '\nINSERT INTO')
                        .replace(/\bVALUES\b/gi, '\nVALUES')
                        .replace(/\bUPDATE\b/gi, '\nUPDATE')
                        .replace(/\bSET\b/gi, '\nSET')
                        .trim();
                },

                truncateSql(sql) {
                    if (!sql) return '';
                    const clean = sql.replace(/\s+/g, ' ').trim();
                    return clean.length > 120 ? clean.substring(0, 120) + '...' : clean;
                },

                filteredUsers() {
                    const s = this.ddUserSearch.toLowerCase();
                    if (!s) return this.filterOptions.users;
                    return this.filterOptions.users.filter(u =>
                        u.name.toLowerCase().includes(s) || u.id.toLowerCase().includes(s)
                    );
                },

                filteredTenants() {
                    const s = this.ddTenantSearch.toLowerCase();
                    if (!s) return this.filterOptions.tenants;
                    return this.filterOptions.tenants.filter(t =>
                        t.name.toLowerCase().includes(s)
                    );
                },

                getUserDisplayName(id) {
                    const user = this.filterOptions.users.find(u => u.id === id);
                    return user ? user.name : id;
                },

                getTenantDisplayName(id) {
                    const tenant = this.filterOptions.tenants.find(t => t.id === id);
                    return tenant ? tenant.name : 'Tenant ' + id;
                },

                getEntrySummary(entry) {
                    if (!entry?.content) return '';
                    switch (entry.type) {
                        case 'REQUEST': return `${entry.content.method} ${entry.content.uri} [${entry.content.status}]`;
                        case 'EXCEPTION': return entry.content.class?.split('.')?.pop() + ': ' + (entry.content.message || '').substring(0, 60);
                        case 'QUERY': return this.truncateSql(entry.content.sql);
                        case 'LOG': return `[${entry.content.level}] ${(entry.content.message || '').substring(0, 60)}`;
                        case 'SCHEDULE': return `${entry.content.class}.${entry.content.method}() [${entry.content.status}]`;
                        case 'CACHE': return `[${entry.content.operation}] ${entry.content.cacheName} ${entry.content.key || ''}`;
                        case 'EVENT': return entry.content.event + (entry.content.source ? ' from ' + entry.content.source : '');
                        case 'MAIL': return `${entry.content.subject || '(no subject)'} -> ${entry.content.to || ''}`;
                        case 'MODEL': return `[${entry.content.action}] ${entry.content.entity} #${entry.content.entityId}`;
                        default: return entry.uuid;
                    }
                }
            };
        }
    </script>
</body>
</html>
